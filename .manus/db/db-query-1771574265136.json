{
  "query": "CREATE TABLE IF NOT EXISTS workflows (\n  id varchar(36) PRIMARY KEY,\n  workflow_number varchar(50) NOT NULL UNIQUE,\n  workflow_type enum('MAF', 'PR') NOT NULL,\n  title varchar(500) NOT NULL,\n  description text,\n  requester_id int NOT NULL,\n  department varchar(100) NOT NULL,\n  estimated_amount decimal(15,2),\n  currency varchar(3) DEFAULT 'IDR',\n  requires_ga boolean DEFAULT false,\n  requires_ppic boolean DEFAULT false,\n  current_stage varchar(100),\n  overall_status enum('draft', 'in_progress', 'completed', 'rejected', 'cancelled') NOT NULL DEFAULT 'draft',\n  submitted_at timestamp NULL,\n  completed_at timestamp NULL,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_workflows_number (workflow_number),\n  INDEX idx_workflows_type (workflow_type),\n  INDEX idx_workflows_requester (requester_id),\n  INDEX idx_workflows_status (overall_status),\n  INDEX idx_workflows_submitted (submitted_at),\n  INDEX idx_workflows_current_stage (current_stage)\n);\n\nCREATE TABLE IF NOT EXISTS workflow_stages (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_order int NOT NULL,\n  stage_name varchar(100) NOT NULL,\n  stage_type varchar(50) NOT NULL,\n  required_role varchar(50),\n  requires_one_of json,\n  approval_threshold decimal(15,2),\n  status enum('pending', 'in_progress', 'completed', 'rejected', 'skipped') NOT NULL DEFAULT 'pending',\n  started_at timestamp NULL,\n  completed_at timestamp NULL,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_stages_workflow (workflow_id),\n  INDEX idx_stages_status (status),\n  INDEX idx_stages_order (workflow_id, stage_order),\n  UNIQUE KEY unique_workflow_stage (workflow_id, stage_order)\n);\n\nCREATE TABLE IF NOT EXISTS workflow_approvals (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_id varchar(36) NOT NULL,\n  approver_id int NOT NULL,\n  approver_role varchar(50) NOT NULL,\n  action enum('approved', 'rejected', 'commented') NOT NULL,\n  comments text,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_approvals_workflow (workflow_id),\n  INDEX idx_approvals_stage (stage_id),\n  INDEX idx_approvals_approver (approver_id),\n  INDEX idx_approvals_action (action),\n  INDEX idx_approvals_created (created_at)\n);\n\nCREATE TABLE IF NOT EXISTS workflow_files (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_id varchar(36),\n  file_name varchar(500) NOT NULL,\n  file_type varchar(50) NOT NULL,\n  file_category varchar(50),\n  s3_bucket varchar(255) NOT NULL,\n  s3_key varchar(1000) NOT NULL,\n  s3_url text,\n  file_size bigint,\n  mime_type varchar(100),\n  uploaded_by int NOT NULL,\n  uploaded_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_files_workflow (workflow_id),\n  INDEX idx_files_stage (stage_id),\n  INDEX idx_files_type (file_type),\n  INDEX idx_files_uploader (uploaded_by),\n  INDEX idx_files_s3_key (s3_key(255))\n);\n\nCREATE TABLE IF NOT EXISTS workflow_comments (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_id varchar(36),\n  comment_text text NOT NULL,\n  comment_type varchar(50) DEFAULT 'general',\n  author_id int NOT NULL,\n  author_role varchar(50),\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_comments_workflow (workflow_id),\n  INDEX idx_comments_stage (stage_id),\n  INDEX idx_comments_author (author_id),\n  INDEX idx_comments_created (created_at)\n);\n\nCREATE TABLE IF NOT EXISTS audit_logs (\n  id varchar(36) PRIMARY KEY,\n  entity_type varchar(50) NOT NULL,\n  entity_id varchar(36) NOT NULL,\n  action varchar(100) NOT NULL,\n  action_description text,\n  actor_id int,\n  actor_email varchar(255),\n  actor_role varchar(50),\n  old_values json,\n  new_values json,\n  ip_address varchar(45),\n  user_agent text,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_audit_entity (entity_type, entity_id),\n  INDEX idx_audit_actor (actor_id),\n  INDEX idx_audit_action (action),\n  INDEX idx_audit_created (created_at)\n);\n\nCREATE TABLE IF NOT EXISTS email_recipients (\n  id varchar(36) PRIMARY KEY,\n  recipient_group varchar(100) NOT NULL,\n  user_id int,\n  email varchar(255) NOT NULL,\n  full_name varchar(255),\n  is_active boolean DEFAULT true,\n  notification_types json,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_group_email (recipient_group, email)\n);\n\nCREATE TABLE IF NOT EXISTS sequence_counters (\n  id varchar(36) PRIMARY KEY,\n  sequence_type enum('MAF', 'PR') NOT NULL,\n  sequence_date varchar(10) NOT NULL,\n  current_counter int NOT NULL DEFAULT 0,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_type_date (sequence_type, sequence_date),\n  INDEX idx_sequence_type_date (sequence_type, sequence_date)\n);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user Y8fKT2LsvR8QMXV.893c95ef4fb6 --database CpEi2h5S6ugwixFhxmPzAJ --execute CREATE TABLE IF NOT EXISTS workflows (\n  id varchar(36) PRIMARY KEY,\n  workflow_number varchar(50) NOT NULL UNIQUE,\n  workflow_type enum('MAF', 'PR') NOT NULL,\n  title varchar(500) NOT NULL,\n  description text,\n  requester_id int NOT NULL,\n  department varchar(100) NOT NULL,\n  estimated_amount decimal(15,2),\n  currency varchar(3) DEFAULT 'IDR',\n  requires_ga boolean DEFAULT false,\n  requires_ppic boolean DEFAULT false,\n  current_stage varchar(100),\n  overall_status enum('draft', 'in_progress', 'completed', 'rejected', 'cancelled') NOT NULL DEFAULT 'draft',\n  submitted_at timestamp NULL,\n  completed_at timestamp NULL,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_workflows_number (workflow_number),\n  INDEX idx_workflows_type (workflow_type),\n  INDEX idx_workflows_requester (requester_id),\n  INDEX idx_workflows_status (overall_status),\n  INDEX idx_workflows_submitted (submitted_at),\n  INDEX idx_workflows_current_stage (current_stage)\n);\n\nCREATE TABLE IF NOT EXISTS workflow_stages (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_order int NOT NULL,\n  stage_name varchar(100) NOT NULL,\n  stage_type varchar(50) NOT NULL,\n  required_role varchar(50),\n  requires_one_of json,\n  approval_threshold decimal(15,2),\n  status enum('pending', 'in_progress', 'completed', 'rejected', 'skipped') NOT NULL DEFAULT 'pending',\n  started_at timestamp NULL,\n  completed_at timestamp NULL,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_stages_workflow (workflow_id),\n  INDEX idx_stages_status (status),\n  INDEX idx_stages_order (workflow_id, stage_order),\n  UNIQUE KEY unique_workflow_stage (workflow_id, stage_order)\n);\n\nCREATE TABLE IF NOT EXISTS workflow_approvals (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_id varchar(36) NOT NULL,\n  approver_id int NOT NULL,\n  approver_role varchar(50) NOT NULL,\n  action enum('approved', 'rejected', 'commented') NOT NULL,\n  comments text,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_approvals_workflow (workflow_id),\n  INDEX idx_approvals_stage (stage_id),\n  INDEX idx_approvals_approver (approver_id),\n  INDEX idx_approvals_action (action),\n  INDEX idx_approvals_created (created_at)\n);\n\nCREATE TABLE IF NOT EXISTS workflow_files (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_id varchar(36),\n  file_name varchar(500) NOT NULL,\n  file_type varchar(50) NOT NULL,\n  file_category varchar(50),\n  s3_bucket varchar(255) NOT NULL,\n  s3_key varchar(1000) NOT NULL,\n  s3_url text,\n  file_size bigint,\n  mime_type varchar(100),\n  uploaded_by int NOT NULL,\n  uploaded_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_files_workflow (workflow_id),\n  INDEX idx_files_stage (stage_id),\n  INDEX idx_files_type (file_type),\n  INDEX idx_files_uploader (uploaded_by),\n  INDEX idx_files_s3_key (s3_key(255))\n);\n\nCREATE TABLE IF NOT EXISTS workflow_comments (\n  id varchar(36) PRIMARY KEY,\n  workflow_id varchar(36) NOT NULL,\n  stage_id varchar(36),\n  comment_text text NOT NULL,\n  comment_type varchar(50) DEFAULT 'general',\n  author_id int NOT NULL,\n  author_role varchar(50),\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_comments_workflow (workflow_id),\n  INDEX idx_comments_stage (stage_id),\n  INDEX idx_comments_author (author_id),\n  INDEX idx_comments_created (created_at)\n);\n\nCREATE TABLE IF NOT EXISTS audit_logs (\n  id varchar(36) PRIMARY KEY,\n  entity_type varchar(50) NOT NULL,\n  entity_id varchar(36) NOT NULL,\n  action varchar(100) NOT NULL,\n  action_description text,\n  actor_id int,\n  actor_email varchar(255),\n  actor_role varchar(50),\n  old_values json,\n  new_values json,\n  ip_address varchar(45),\n  user_agent text,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  metadata json,\n  INDEX idx_audit_entity (entity_type, entity_id),\n  INDEX idx_audit_actor (actor_id),\n  INDEX idx_audit_action (action),\n  INDEX idx_audit_created (created_at)\n);\n\nCREATE TABLE IF NOT EXISTS email_recipients (\n  id varchar(36) PRIMARY KEY,\n  recipient_group varchar(100) NOT NULL,\n  user_id int,\n  email varchar(255) NOT NULL,\n  full_name varchar(255),\n  is_active boolean DEFAULT true,\n  notification_types json,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_group_email (recipient_group, email)\n);\n\nCREATE TABLE IF NOT EXISTS sequence_counters (\n  id varchar(36) PRIMARY KEY,\n  sequence_type enum('MAF', 'PR') NOT NULL,\n  sequence_date varchar(10) NOT NULL,\n  current_counter int NOT NULL DEFAULT 0,\n  created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_type_date (sequence_type, sequence_date),\n  INDEX idx_sequence_type_date (sequence_type, sequence_date)\n);",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 3161
}